
options
{
  static = true;
  VISITOR = true;
}

PARSER_BEGIN(SJaPParser)

import AST.start;
import AST.Linjer;
import AST.Linje;
import AST.Dcl_Var;
import AST.Dcl_Metode;
import AST.Decl_Metoder;
import AST.Ellers_Statment;
import AST.For_Lokke;
import AST.If_Statement;
import AST.ListOfVars;
import AST.Metode;
import AST.Operation;
import AST.Returner;
import AST.Sammenlign;
import AST.Stat;
import AST.Stats;
import AST.Term;
import AST.Type;
import AST.Variabel;
import AST.Vars;
import AST.While_Lokke;

public class SJaPParser
{
   
   
  public static void main(String args []) throws ParseException
  {
    
    SJaPParser parser = new SJaPParser(System.in);
    
    while (true)
    {
      System.out.println("Reading from standard input...");
      System.out.print("Enter an expression like \"1+(2+3)*4;\" :");
      
      try
      {
        start AST = start();
      }
      catch (Exception e)
      {
        System.out.println("NOK.");
        System.out.println(e.getMessage());
        SJaPParser.ReInit(System.in);
      }
      catch (Error e)
      {
        System.out.println("Oops.");
        System.out.println(e.getMessage());
        break;
      }
    }
  }
}

PARSER_END(SJaPParser)

SKIP :
{
  " "
| "\r"
| "\t"
| "\n"
|  <"//" (~["\n","\r"])* ("\n" | "\r" | "\r\n")>
|  <"/*" (~["*"])* "*" ("*" | ~["*","/"] (~["*"])* "*")* "/">
}

TOKEN : /* OPERATORS */
{
  < PLUS : "+" >
| < MINUS : "-" >
| < MULTIPLY : "*" >
| < DIVIDE : "/" >
| < MODULO : "%" >
| < TIL : "til">
| < FRA: "fra">
| < HVIS : "hvis">
| < ELLERS : "ellers">
| < SOM : "som">
| < AF : "af">
| < FUNKTION : "funktion">
| < TAL : "tal">
| < TEKST : "tekst">
| < UDSAGN : "udsag">
| < SALANGE : "sålænge">
| < GENTAG : "gentag">
| < OG : "og">
| < ELLER : "eller">
| < PRINT : "print">
| < INPUT : "input">
| < OPENFILE : "åbenfil">
| < CLOSEFILE : "lukfil">
| < START : "start">
| < RETURNER : "returner">
| < SANDT : "sandt">
| < FALSK : "falsk">
| < TILFOJ : "tilføj" >
| < LENGDEN : "længden" >
| < LISTE : "liste" >
| < SLET : "slet" >
}

TOKEN :
{
  < CONSTANT : (< DIGIT >)+ >
| < NUM : ("-")? (< DIGIT1>)(< DIGIT>)*(","(< DIGIT>)*(< DIGIT1>))?>
| < STRING :"\"" (< LETTER >|< CHAR >|< DIGIT >)* "\"">
| < ID : (< LETTER>|"_")(< LETTER>|< DIGIT>|"_")*>
| < BOOL : ("sandt"| "falsk")>
| < #DIGIT : [ "0"-"9" ] >
| < #DIGIT1: [ "1"-"9"] >
| < #LETTER : [ "a"-"z","A"-"Z","æ","ø","å","Æ","Ø","Å"]>
| < #CHAR : [ "!","@","#","£","¤","$","%","&","\\","/","=","?","+","`","|","^","~","*",",",".","_",":",";","<",">","½","-","¨","§","¾","´"]>

| < EOL: (["\n","\t","\r"])>

}



start start () : {start s= new start();}
{
  (
    dcl_metoder() < START > "{" s.startLinjer=linjer()"}" dcl_metoder())
}

Linjer linjer ()  : {Linjer l = new Linjer();}
{
  (l.nyLinje=linje() ";")+
}

Linje linje() : {Linje l = new Linje();}
{
 (LOOKAHEAD(dcl_var()) l.linjeIndhold=dcl_var()
| LOOKAHEAD(vars()) l.linjeIndhold=vars()
| l.linjeIndhold=if_statment()
| l.linjeIndhold=while_lokke()
| l.linjeIndhold=for_lokke()
|< RETURNER > {l.linjeIndhold= new Returner(operation());} 

  )
}

Dcl_Var dcl_var() : {}
{
  ( LOOKAHEAD(< ID > <SOM > type() ";") < ID > <SOM > type()
  | LOOKAHEAD(< ID > "=") < ID > "=" operation()
  | LOOKAHEAD(< ID > <SOM > type() "=") < ID > <SOM > type() "=" operation()
  | LOOKAHEAD(< ID > "[") < ID > "[" operation() "]" "=" operation()
  | LOOKAHEAD("tilføj") < TILFOJ > operation() < TIL > <ID >
  | LOOKAHEAD("slet") < SLET > <ID > "[" operation() "]"
  )

  //declerer variablerne i symbol tabellen
}

Vars vars() : {}
{
  (
    variabel()
  | LOOKAHEAD(< ID >)< ID > 
  | < LENGDEN > < AF > < ID >
  | LOOKAHEAD(< ID > < FRA >) < ID > < FRA > operation() < TIL > operation()
  | metode()
  )
	
  //søg og find i symbol tabelen
}

Variabel variabel() : {}
{
  (
    < NUM >
  | < STRING >
  | < BOOL >
  )
}

Type type() : {}
{
  (
    < TAL >
  | < TEKST >
  | < UDSAGN >
  | < LISTE > < AF > type()
  )
}

Decl_Metoder dcl_metoder() : {}
{
  (dcl_metode()  )*
}

Dcl_Metode dcl_metode() : {}
{
  (LOOKAHEAD("som")< FUNKTION > < ID > < SOM > type()"("list_of_vars()")" "{"linjer()"}"
| < FUNKTION > < ID > "("list_of_vars()")" "{"linjer()"}")
}

Metode metode() : {}
{
  (< ID > "(" list_of_vars()")")
}

Operation operation() : {}
{
  (LOOKAHEAD("+") term() "+" operation()
| LOOKAHEAD("-") term() "-" operation()
| term()
  )
}

Term term() : {}
{
  (LOOKAHEAD("*") vars() "*" term()
| LOOKAHEAD("/")vars() "/" term()
| "(" operation() ")"
| vars()
  )
}

If_Statement if_statment() : {}
{
  (< HVIS > stats() "{" linjer() "}" ellers_statment()
  )
}

Ellers_Statment ellers_statment() : {}
{
  ( LOOKAHEAD("{")< ELLERS > "{" linjer() "}"
| < ELLERS > if_statment()
  )
}

While_Lokke while_lokke() : {}
{
  (< SALANGE > stats() < GENTAG > "{" linjer() "}"
  )
}
For_Lokke for_lokke() : {}
{
  (< GENTAG > operation() < TIL > operation() "{" linjer() "}"
  )
}

Stats stats() : {}
{
  (LOOKAHEAD(< OG >) stat() < OG > stat()
| LOOKAHEAD(< ELLER >) stat() < ELLER > stat()
| stat()
  )
}

Stat stat() : {}
{
  (LOOKAHEAD(operation()) operation() sammenlign() operation()
| "(" stats() ")"
| vars()
| "!" stat()
  )
}

Sammenlign sammenlign() : {}
{
  (">" // større end
| "<" // mindre end
| ">=" // større end eller lig med
| "<=" // mindre end eller lig med
| "==" // lig med
| "!=" // ikke lig med
  )
}

ListOfVars list_of_vars() : {}
{
  (operation())*
}

